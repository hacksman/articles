
å‡æœŸæ­£å¥½æœ‰ç©ºé—²æ—¶é—´ï¼Œç»ˆäºå¯ä»¥æ•´ç†è‡ªå·±çš„ç¬”è®°å•¦ã€‚æ•´ç†åˆ°æŠ–éŸ³è§†é¢‘çš„æ—¶å€™ï¼Œå°±å¥½éº»çƒ¦ï¼Œæ¯æ¬¡éƒ½è¦å…ˆæŠŠè§†é¢‘å¯¼å‡ºåˆ°æœ¬åœ°ï¼Œå†ç»™å¾®ä¿¡çš„æ–‡ä»¶ç®¡ç†åŠ©æ‰‹ï¼Œå†ä¸‹è½½ä¼ åˆ°å°è±¡ç¬”è®°ï¼Œä¸€æ¥äºŒå»æµªè´¹ä¸å°‘æ—¶é—´ï¼Œæƒ³æƒ³è¿™äº‹ä¸æ­£å¥½é€‚åˆçˆ¬è™«å»å¹²å—ï¼Ÿäºæ˜¯å°±æœ‰äº†ä»¥ä¸‹è¿™ç¯‡å†…å®¹

### å·¥å…·ç¯å¢ƒ
- è¯­è¨€ï¼šPython3.6
- ç¼–è¾‘å™¨ï¼šPycharm
- æ•°æ®åº“ï¼šMongoDB
- å·¥å…·ï¼šCharles

### å‰è¨€ï¼š
åœ¨ä½¿ç”¨Charlesï¼Œä½ éœ€è¦åšä¸€äº›åŸºç¡€çš„é…ç½®ï¼Œå°†ä½ çš„æ‰‹æœºçš„ç½‘ç»œä»£ç†åˆ°æœ¬åœ°ç”µè„‘ï¼Œä»¥ä¾¿åšè¿›ä¸€æ­¥çš„æŠ“åŒ…åˆ†æï¼Œä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« å¯èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©

1. [https://www.jianshu.com/p/a3f005628d07][1]
2. [https://www.jianshu.com/p/68684780c1b0][2]

### çˆ¬å–æ€è·¯
çˆ¬å–ç«™ç‚¹ï¼š[https://www.douyin.com/Â ][3]

è¿™é‡Œçš„çˆ¬å–æ€è·¯éå¸¸ç®€å•ï¼Œä»¥è‡³äºæˆ‘ä¼šè§‰å¾—è¿™ç¯‡æ–‡ç« ä¼šæœ‰äº›ç©ºæ´ã€‚å½“ä½ æŠ“åŒ…æ­£ç¡®é…ç½®å¥½ç¯å¢ƒåï¼Œæ‰“å¼€æŠ–éŸ³è½¯ä»¶ï¼Œåšä¸€äº›ç®€å•çš„æ“ä½œï¼ŒCharleså°±ä¼šç»™ä½ è¿”å›å¦‚ä¸‹çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å…¶å®å°±æ˜¯æœåŠ¡ç«¯ç»™ä½ è¿”å›çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘ä»¬ä»Šå¤©è¦ä¸‹è½½çš„è‡ªå·±ç‚¹å‡»è¿‡çš„ï¼Œå–œæ¬¢çš„è§†é¢‘é“¾æ¥ç­‰

ä½ æ“ä½œè½¯ä»¶æ—¶ï¼Œçœ‹ä¸€ä¸‹Charlesä¸­æ¯æ¡æ•°æ®çš„å˜åŒ–æƒ…å†µï¼Œä½ ä¼šå‘ç°ï¼Œä½ ä¸ªäººä¸»é¡µä¸‹é¢çš„é“¾è·Ÿvideosã€feedå’Œlikeså’Œè¿™ä¸‰æ¡æ•°æ®æœ‰å…³ï¼Œæ¯ä¸€æ¬¡ä½ åšç›¸åº”çš„æ“ä½œï¼Œä¸‹é¢å°±ä¼šå¤šå‡ºä¸€äº›è¯·æ±‚é“¾æ¥


é‚£æˆ‘ä»¬åˆ«çš„å…ˆä¸ç®¡ï¼Œçœ‹ä¸‹æ¯ä¸ªè¯·æ±‚ä¸­çš„æ•°æ®ï¼Œæœ‰æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œéšä¾¿çœ‹ä¸€ä¸‹æŸä¸ªé“¾æ¥ä¸­çš„è¿”å›æ•°æ®

å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰play\_addï¼Œå†ä¸€çœ‹é“¾æ¥ä¸­æœ‰videoå­—æ ·ï¼ŒåŸºæœ¬å…«ä¹ä¸ç¦»åäº†ã€‚å› ä¸ºæˆ‘å·²ç»éªŒè¯è¿‡äº†ï¼Œè¿™é‡Œçš„ä¿¡æ¯å°±æ˜¯å¦‚æˆ‘ä»¬çŒœæµ‹çš„é‚£æ ·ï¼ŒåŒ…å«è§†é¢‘çš„å…¨éƒ¨ä¿¡æ¯

é‚£æˆ‘ä»¬å…¶å®å°±éœ€è¦æ¨¡æ‹Ÿè¿™é‡Œçš„è¯·æ±‚é“¾æ¥å³å¯ï¼Œå…ˆçœ‹ä¸‹è¯·æ±‚ä¸­éƒ½åŒ…å«å“ªäº›å¿…è¦çš„ä¿¡æ¯ï¼Œä½ å¤šçœ‹å‡ ä¸ªå°±å‘ç°ï¼ŒçœŸæ­£å˜åŒ–çš„å°±å‡ ä¸ªå›ºå®šçš„å‚æ•°ï¼Œå…¶ä¸­çº¢çº¿ä»¥ä¸Šçš„éƒ¨åˆ†éƒ½æ˜¯å’Œè®¾å¤‡ç›¸å…³çš„ä¿¡æ¯å’Œappä¿¡æ¯ï¼ŒçœŸæ­£æ ¸å¿ƒåŠ å¯†çš„å‚æ•°å°±åªæœ‰ï¼Œmasï¼Œaså’Œtsã€‚è¿™é‡Œæˆ‘å…ˆè‡ªå·±ç½‘ä¸Šæ‰¾äº†ä¸‹æœ‰æ²¡æœ‰ç›¸å…³çš„è½®å­å¯ç”¨ï¼Œç´¢æ€§ç‹—å±è¿æ¯”è¾ƒå¥½ï¼Œæ­£å¥½æ‰¾åˆ°äº†ï¼Œåœ°å€åœ¨è¿™ï¼š[https://github.com/AppSign/douyin][4]

å¥—ç”¨å³å¯ï¼Œè€Œä¸”è¿™ä½å¤§ä½¬çš„æ‰€æœ‰ç ´è§£ï¼Œéƒ½æ˜¯å’Œå­—èŠ‚è·³åŠ¨æœ‰å…³çš„ï¼Œæˆ‘æœ‰ç‚¹è§‰å¾—è¿™ä¸ªå°±æ˜¯å®˜æ–¹è®©å‘˜å·¥è‡ªå·±æ”¾å‡ºæ¥çš„ã€‚æŒ‰å°¼èƒƒï¼Œæˆ‘ä»¬æ‹¿åˆ°äº†åŠ å¯†çš„å‚æ•°çš„å®ç°ä¹‹åï¼Œåé¢å°±å¤ªç®€å•äº†

çœ‹ä¸Šé¢é‚£ä½å¤§ä½¬çš„ä»£ç æå–è§†é¢‘é‚£é‡Œï¼Œè·Ÿè§†é¢‘ç›¸å…³çš„å…³é”®å‚æ•°å°±æ˜¯è¿™ä¸ªaweme\_idï¼Œæˆ‘ä»¬æ‹¿åˆ°å®ƒä¹‹åï¼Œåé¢ç›´æ¥æ„é€ æå–åŸè§†é¢‘çš„è¯·æ±‚å³å¯ã€‚

é‚£ä¹ˆåºŸè¯ä¸è¯´ï¼Œä¸Šç èµ°èµ·


### show me the code

#### æ ¸å¿ƒè¯·æ±‚ï¼š


    def grabfavorite(self, userid, maxcursor=0):
        favoriteparams = self.FAVORITEPARAMS
        favoriteparams'userid'] = userid
        favoriteparams'maxcursor'] = maxcursor
        queryparams = {favoriteparams, self.commonparams}
        sign = getSign(self.gettoken(), queryparams)
        params = {queryparams, sign}
        resp = requests.get(self.FAVORITEURL,
                            params=params,
                            verify=False,
                            headers=self.HEADERS)

        favoriteinfo = resp.json()

        hasmore = favoriteinfo.get('hasmore')
        maxcursor = favoriteinfo.get('maxcursor')

        videoinfos = favoriteinfo.get('awemelist')

        for pervideo in videoinfos:
            authornickname = pervideo'author'.get("nickname")
            authoruid = pervideo'author'.get('uid')
            videodesc = pervideo.get('desc')
            downloaditem = {
                "authornickname": authornickname,
                "videodesc": videodesc,
                "authoruid": authoruid,
            }
            awemeid = pervideo.get("awemeid")
            self.downloadfavoritevideo(awemeid, downloaditem)
            time.sleep(5)

        return hasmore, maxcursor


è¿™é‡Œæˆ‘ä»¬å°†è®¾å¤‡å‚æ•°ï¼Œappä¿¡æ¯ï¼Œç”¨æˆ·ä¸€èµ·ç”¨ä½œæŸ¥è¯¢å‚æ•°ï¼Œå†ä¸è·å¾—çš„tokenä¸€èµ·ï¼Œå‘é€ç»™getSignå‡½æ•°ï¼Œæ„é€ åŠ å¯†æ•°æ®ï¼Œæœ€åæŠŠè¿™äº›æ•°æ®ç»„åˆæˆçš„å­—å…¸æ”¾åœ¨ä¸€èµ·ï¼Œè¯·æ±‚æˆ‘ä»¬çš„å–œæ¬¢çš„é“¾æ¥ï¼ˆhttps://aweme.snssdk.com/aweme/v1/aweme/favorite/
ï¼‰å³å¯æ‹¿åˆ°å¯¹åº”çš„responseæ•°æ®ã€‚å¤§å®¶å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘è¿™é‡Œæ¼æ‰äº†ä¸€ä¸ªmax\_cursorå‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºï¼Œç¬¬ä¸€æ¬¡å‘é€è¯·æ±‚æ—¶ï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯0ï¼Œä¹‹åæˆ‘ä»¬è¯·æ±‚äº†æ•°æ®åï¼Œå¦‚æœè¿”å›çš„has\_moreæ˜¯1ï¼Œå°±ä»£è¡¨æœ‰æ•°æ®ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æˆ‘ä»¬è¯·æ±‚çš„æ—¶å€™ï¼Œå°±éœ€è¦å¸¦ä¸Šä¸Šä¸€æ¬¡çš„max\_cursorã€‚å°±å¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬åˆ·æ•°æ®ï¼Œå¾€ä¸‹ç¿»é¡µå§

æ‰€ä»¥è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨è¿™ä¸ªåœ°æ–¹åšäº†è¿”å›ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿ä¸Šä¸€å±‚è°ƒç”¨ï¼Œçœ‹ä¸‹è¿™é‡Œå¦‚æœæœ‰æ•°æ®çš„è¯ï¼Œæˆ‘ä»¬å°±ç»§ç»­ç¿»é¡µä¸‹è½½

#### ç¿»é¡µï¼š

__FAVORITE_URL              = ""
    def grabfavoritemain(self, userid):
        count = 1
        self.logger.info("å½“å‰æ­£åœ¨çˆ¬å–ç¬¬ ğŸ‘‰ {} ğŸ‘ˆ é¡µå†…å®¹...".format(count))
        hasmore, maxcursor = self.grabfavorite(userid)
        while hasmore:
            count += 1
            self.logger.info("å½“å‰æ­£åœ¨çˆ¬å–ç¬¬ ğŸ‘‰ {} ğŸ‘ˆ é¡µå†…å®¹...".format(count))
            hasmore, maxcursor = self.grabfavorite(userid, maxcursor)


æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚åå¾—åˆ°æ˜¯å¦æœ‰æ•°æ®çš„çŠ¶æ€å’Œmax\_cursorå‚æ•°ï¼Œé‚£å°±ç®€å•äº†ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°æœ‰æ›´å¤šæ•°æ®ï¼Œå°±ç»§ç»­è¯·æ±‚å³å¯

#### è§†é¢‘ä¸‹è½½

    def grabfavoritemain(self, userid):
        count = 1
        self.logger.info("å½“å‰æ­£åœ¨çˆ¬å–ç¬¬ ğŸ‘‰ {} ğŸ‘ˆ é¡µå†…å®¹...".format(count))
        hasmore, maxcursor = self.grabfavorite(userid)
        while hasmore:
            count += 1
            self.logger.info("å½“å‰æ­£åœ¨çˆ¬å–ç¬¬ ğŸ‘‰ {} ğŸ‘ˆ é¡µå†…å®¹...".format(count))
            hasmore, maxcursor = self.grabfavorite(userid, maxcursor)
    def downloadfavoritevideo(self, awemeid, videoinfos):
        videocontent = self.downloadvideo(awemeid)
        authornickname = videoinfos.get("authornickname")
        authoruid = videoinfos.get("authoruid")
        videodesc = videoinfos.get("videodesc")
        videoname = "".join(authornickname, authoruid, videodesc)

        self.logger.info("downloadfavoritevideo æ­£åœ¨ä¸‹è½½è§†é¢‘ {} ".format(videoname))

        if not videocontent:
            self.logger.warn("ä½ æ­£åœ¨ä¸‹è½½çš„è§†é¢‘ï¼Œç”±äºæŸç§ç¥ç§˜åŠ›é‡çš„ä½œç”¨ï¼Œå·²ç»å‡‰å‡‰äº†ï¼Œè¯·è·³è¿‡...")
            return

        with open("../videos/{}.mp4".format(videoname), 'wb') as f:
            f.write(videocontent)

    def downloadvideo(self, awemeid, retrytimes=0):
        queryparams = self.commonparams
        queryparams'awemeid'] = awemeid

        sign = getSign(self.gettoken(), queryparams)
        params = {queryparams, sign}

        postdata = {
            "awemeid": awemeid
        }

        resp = requests.get(self.VIDEODETAILURL,
                            params=params,
                            data=postdata,
                            verify=False,
                            headers=self.HEADERS)
        respresult = resp.json()
        playaddrraw = respresult'awemedetail']'video''playaddr''urllist'

        content = requests.get(playaddr).content

        return content


ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æ„é€ äº†signç­¾åä¹‹åï¼Œè¯·æ±‚è§†é¢‘è·å–é“¾æ¥ï¼Œä¼ å…¥å¯¹åº”çš„aweme\_idå³å¯æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„è§†é¢‘æ•°æ®ï¼Œæœ€åç›´æ¥ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å†™å…¥æ–‡ä»¶å³å¯ã€‚æ–‡ä»¶åæˆ‘è¿™é‡Œæ˜¯ç”¨çš„ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·å”¯ä¸€idå’Œè§†é¢‘æè¿°ï¼Œå¦‚æœè§‰å¾—å¤ªé•¿ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è‡ªå·±æ”¹æˆè‡ªå·±æƒ³è¦çš„æ–‡ä»¶å

æœ€åå¼€å¯çˆ¬è™«ï¼Œå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœ


ä»¥ä¸Šå®ç°çˆ¬å–è‡ªå·±æŠ–éŸ³å–œæ¬¢è¿‡çš„æ‰€æœ‰è§†é¢‘çš„æ­¥éª¤ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±å®Œæ•´èµ°ä¸€éè¿‡ç¨‹ï¼Œæˆ–è€…ç›´æ¥æ‹·è´æˆ‘åœ¨githubä¸Šçš„ä»£ç åœ°å€ï¼Œæ³¨æ„user\_idè¦æ”¹æˆä½ è‡ªå·±çš„å“¦ï¼Œ
å¦å¤–åç»­æˆ‘è¿™ä¸ªä»“åº“ä¼šå¢åŠ æ›´å¤šæœ‰è¶£å®ç”¨çš„çˆ¬è™«ï¼Œæ¬¢è¿å¤§å®¶ç»™æ˜Ÿï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥å‘æˆ‘åé¦ˆï¼Œä¸€èµ·å­¦ä¹ è¿›æ­¥



[1]:	https://www.jianshu.com/p/a3f005628d07
[2]:	https://www.jianshu.com/p/68684780c1b0
[3]:	http://www.dytt8.net/
[4]:	https://github.com/AppSign/douyin
